<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Bomb Dash - 8bit shooter retro game" />
    <!-- ðŸŒ¹ AVRE SIGNATURE -->
    <meta name="author" content="Alan Victor Rocha Evangelista (AVRE)" />
    <title>ðŸ’£ Bomb Dash</title>

    <script type="module">
      import { Buffer } from 'buffer';
      import process from 'process';
      window.Buffer = Buffer;
      window.process = process;
    </script>

    <!-- Phaser CDN -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>

    <style>
      /*
     * ðŸŒ¹ AVRE AESTHETIC SYSTEM
     * Palette: Crimson (#DC143C) | White (#FFFFFF) | Void (#000000)
     */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        width: 100%;
        height: 100%;
        background-color: #000;
        font-family: 'Press Start 2P', monospace;
        overflow: hidden;
      }

      #phaser-dom-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
      }
      #phaser-dom-container input {
        pointer-events: auto;
      }

      canvas {
        display: block;
        margin: auto;
        image-rendering: pixelated;
        /* ðŸŒ¹ The Crimson Touch */
        border: 2px solid #dc143c;
        box-shadow: 0 0 20px rgba(220, 20, 60, 0.4);
        max-width: 100vw;
        max-height: 100vh;
      }

      /* ðŸŒ¹ Glassmorphism & Red Mode */
      .form-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 400px;
        padding: 25px;
        background-color: rgba(20, 0, 0, 0.9); /* Deep Burgundy */
        border: 2px solid #dc143c; /* Crimson */
        border-radius: 8px;
        z-index: 100;
        color: #ffffff;
        font-family: 'Press Start 2P', monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        /* ðŸŒ¹ AVRE Shadow */
        box-shadow: 0 4px 14px rgba(220, 20, 60, 0.25);
        backdrop-filter: blur(5px);
        transition: all 0.3s ease;
      }

      .form-box {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .form-title {
        font-size: 20px;
        margin-bottom: 25px;
        color: #ffffff;
        text-shadow: 0 0 10px #dc143c;
      }

      .form-container label {
        font-size: 10px;
        margin-top: 10px;
        margin-bottom: 5px;
        width: 100%;
        max-width: 300px;
        text-align: left;
        color: #dc143c;
        text-transform: uppercase;
      }

      .form-container input[type='text'],
      .form-container input[type='password'] {
        width: 100%;
        max-width: 300px;
        padding: 12px;
        font-size: 14px;
        border: 1px solid #dc143c;
        background-color: #1a0505; /* Very Dark Red */
        color: #fff;
        font-family: monospace;
        margin-bottom: 15px;
        border-radius: 4px;
        outline: none;
        transition: all 0.3s ease;
      }

      .form-container input:focus {
        box-shadow: 0 0 10px #dc143c;
        border-color: #ffffff;
      }

      .form-message {
        font-size: 10px;
        color: #ff4444; /* Bright Red for Errors */
        min-height: 20px;
        text-align: center;
        width: 100%;
        max-width: 300px;
        margin-bottom: 10px;
        word-wrap: break-word;
      }

      .form-message.success {
        color: #ffffff;
        border-left: 3px solid #dc143c;
        padding-left: 10px;
      }
      .form-message.processing {
        color: #ffffff;
        opacity: 0.8;
      }

      /* ðŸŒ¹ Organic Motion Buttons */
      .form-button {
        width: 100%;
        max-width: 300px;
        padding: 12px 15px;
        font-size: 12px;
        font-family: 'Press Start 2P', monospace;
        color: #ffffff;
        background-color: #dc143c; /* Crimson */
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 15px;
        text-align: center;
        transition: all 0.2s ease;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      }

      .form-button:hover {
        background-color: #b22222; /* Firebrick */
        transform: scale(1.02);
        box-shadow: 0 0 15px rgba(220, 20, 60, 0.6);
      }

      .form-button.secondary {
        background-color: transparent;
        border: 1px solid #ffffff;
        color: #ffffff;
      }
      .form-button.secondary:hover {
        background-color: #ffffff;
        color: #dc143c;
        border-color: #ffffff;
      }

      .form-tip {
        font-size: 9px;
        color: #aaaaaa;
        margin-top: 20px;
        text-align: center;
        width: 100%;
        max-width: 300px;
      }

      /* Confetti (Hidden by default) */
      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: #dc143c;
        animation: fall linear forwards;
        z-index: 9999;
      }
      @keyframes fall {
        to {
          transform: translateY(100vh) rotate(720deg);
        }
      }
    </style>
  </head>

  <body>
    <div id="phaser-dom-container"></div>
    <script type="module" src="./main.js"></script>

    <!-- Register Form -->
    <div
      id="register-form-container"
      class="form-container"
      style="display: none"
    >
      <div class="form-box">
        <h2 class="form-title">JOIN THE LEGACY</h2>
        <label for="register-username">Username:</label>
        <input
          type="text"
          id="register-username"
          name="register-username"
          autocomplete="username"
        />
        <label for="register-pin">PIN (4 digits):</label>
        <input
          type="password"
          id="register-pin"
          name="register-pin"
          maxlength="4"
          autocomplete="new-password"
        />
        <p id="register-message" class="form-message"></p>
        <button type="button" id="register-submit-button" class="form-button">
          IGNITE
        </button>
        <button
          type="button"
          id="register-back-button"
          class="form-button secondary"
        >
          RETURN
        </button>
        <p class="form-tip">Create your mark. Username & 4-digit PIN.</p>
        <p
          class="form-pin-warning"
          style="color: #ff4444; font-size: 8px; margin-top: 10px"
        >
          WARNING: PIN IS IRRECOVERABLE.
        </p>
      </div>
    </div>

    <!-- Login Form -->
    <div id="login-form-container" class="form-container" style="display: none">
      <div class="form-box">
        <h2 class="form-title">AUTHENTICATE</h2>
        <label for="login-username">Username:</label>
        <input
          type="text"
          id="login-username"
          name="login-username"
          autocomplete="username"
        />
        <label for="login-pin">PIN (4 digits):</label>
        <input
          type="password"
          id="login-pin"
          name="login-pin"
          maxlength="4"
          autocomplete="current-password"
        />
        <p id="login-message" class="form-message"></p>
        <button type="button" id="login-submit-button" class="form-button">
          ENTER
        </button>
        <button
          type="button"
          id="login-back-button"
          class="form-button secondary"
        >
          RETURN
        </button>
      </div>
    </div>

    <!-- PvP Lobby -->
    <div id="pvp-lobby-container" class="form-container" style="display: none">
      <div class="form-box">
        <h2 class="form-title">PVP ARENA</h2>
        <p class="form-message" style="color: #ffffff; min-height: 40px">
          Choose your battlefield.
        </p>
        <button type="button" id="ranked-mode-button" class="form-button">
          RANKED MODE
        </button>
        <button type="button" id="wager-arena-button" class="form-button">
          HIGH STAKES
        </button>
        <button
          type="button"
          id="pvp-lobby-back-button"
          class="form-button secondary"
        >
          RETURN
        </button>
      </div>
    </div>

    <!-- Wager Arena -->
    <div
      id="wager-arena-container"
      class="form-container"
      style="display: none"
    >
      <div class="form-box">
        <h2 class="form-title">HIGH STAKES</h2>
        <p id="wager-arena-message" class="form-message" style="color: #ffffff">
          Fortune favors the bold.
        </p>

        <div
          id="wager-tiers-list"
          style="width: 100%; max-width: 300px; margin-bottom: 20px"
        >
          <button
            type="button"
            class="form-button wager-tier-button"
            data-tier-id="1"
          >
            Bronze: 10 BCOIN / 20 XP
          </button>
          <button
            type="button"
            class="form-button wager-tier-button"
            data-tier-id="2"
          >
            Silver: 50 BCOIN / 100 XP
          </button>
          <button
            type="button"
            class="form-button wager-tier-button"
            data-tier-id="3"
          >
            Gold: 200 BCOIN / 500 XP
          </button>
        </div>

        <button
          type="button"
          id="wager-arena-back-button"
          class="form-button secondary"
        >
          RETURN
        </button>
      </div>

      <div
        id="wager-confirm-dialog"
        class="form-container"
        style="
          display: none;
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
        "
      >
        <div class="form-box">
          <h2 class="form-title" style="color: #dc143c">FINAL WARNING</h2>
          <p
            id="wager-confirm-message"
            class="form-message"
            style="color: #ffffff; font-size: 10px; min-height: 60px"
          >
            You are risking X BCOIN and Y XP. Defeat means de-leveling. Proceed?
          </p>
          <button type="button" id="wager-confirm-button" class="form-button">
            ACCEPT FATE
          </button>
          <button
            type="button"
            id="wager-cancel-button"
            class="form-button secondary"
          >
            RETREAT
          </button>
        </div>
      </div>
    </div>

    <!-- ðŸ¤« AVRE Easter Egg: Konami Code -->
    <script>
      const konamiCode = [
        'ArrowUp',
        'ArrowUp',
        'ArrowDown',
        'ArrowDown',
        'ArrowLeft',
        'ArrowRight',
        'ArrowLeft',
        'ArrowRight',
        'b',
        'a',
      ];
      let konamiIndex = 0;

      document.addEventListener('keydown', (e) => {
        if (e.key === konamiCode[konamiIndex]) {
          konamiIndex++;
          if (konamiIndex === konamiCode.length) {
            activateAVREMode();
            konamiIndex = 0;
          }
        } else {
          konamiIndex = 0;
        }
      });

      function activateAVREMode() {
        console.log(
          '%cðŸŒ¹ AVRE MODE ACTIVATED ðŸŒ¹',
          'color: #DC143C; font-size: 24px; font-weight: bold;'
        );

        // Confetti Explosion
        for (let i = 0; i < 100; i++) {
          createConfetti();
        }

        // Pulse Effect
        const overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.backgroundColor = 'rgba(220, 20, 60, 0.5)';
        overlay.style.zIndex = '99999';
        overlay.style.pointerEvents = 'none';
        overlay.style.transition = 'opacity 0.5s ease';
        document.body.appendChild(overlay);

        setTimeout(() => {
          overlay.style.opacity = '0';
        }, 100);
        setTimeout(() => {
          document.body.removeChild(overlay);
        }, 600);
      }

      function createConfetti() {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor =
          Math.random() > 0.5 ? '#DC143C' : '#FFFFFF';
        confetti.style.animationDuration = Math.random() * 2 + 1 + 's';
        document.body.appendChild(confetti);

        setTimeout(() => {
          confetti.remove();
        }, 3000);
      }
    </script>
  </body>
</html>
